Bubbly Teal Rooster

medium

# Front-running the escape option to receive rewards before agents get wounded
## Summary
Front-running the escape option to receive rewards before agents get wounded

## Vulnerability Detail
The  function `rawFulfillRandomWords()` is designed to be called by the VRFCoordinator and allows the VRFCoordinator to provide random numbers to the protocol. However, this setup can be vulnerable to front-running.
```solidity
  function rawFulfillRandomWords(uint256 requestId, uint256[] memory randomWords) external {
    if (msg.sender != vrfCoordinator) {
      revert OnlyCoordinatorCanFulfill(msg.sender, vrfCoordinator);
    }
    fulfillRandomWords(requestId, randomWords);
  }
```
Here's how the issue arises:

The `VRFCoordinator` generates and provides random numbers through this function.

Malicious actors can monitor and observe the random numbers generated by the VRFCoordinator.

Based on the observed random numbers, malicious actors can calculate the outcome of the game or the impact on their agents, such as determining which agents will get wounded.

Armed with this information, malicious actors can then prematurely call the `escape()` function to obtain the rewards for escaping before the actual game results are revealed.
```solidity
 function escape(uint256[] calldata agentIds) external nonReentrant {
        _assertFrontrunLockIsOff();

        uint256 agentIdsCount = agentIds.length;
        _assertNotEmptyAgentIdsArrayProvided(agentIdsCount);

        uint256 activeAgents = gameInfo.activeAgents;
        uint256 activeAgentsAfterEscape = activeAgents - agentIdsCount;
        _assertGameIsNotOverAfterEscape(activeAgentsAfterEscape);

```

## Impact
This scenario allows malicious actors to gain an unfair advantage by manipulating the game's outcome based on foreknowledge of the random numbers.

## Code Snippet
https://github.com/sherlock-audit/2023-10-looksrare/blob/main/contracts-infiltration/contracts/Infiltration.sol#L716-L796

## Tool used

Manual Review

## Recommendation
To address this issue, additional measures may need to be implemented to ensure that the game outcomes are not prematurely revealed or exploited by external actors. 
